
> web-sequencer@0.0.0 test
> vitest --run
 RUN  v4.0.16 /Users/anton/WebstormProjects/web-sequencer
 ✓ src/dsl/__tests__/swing.test.ts (14 tests) 7ms
 ✓ src/dsl/__tests__/pitch.test.ts (45 tests) 16ms
 ✓ src/dsl/__tests__/duration.test.ts (39 tests) 19ms
 ✓ src/audio/__tests__/scheduler.test.ts (39 tests) 20ms
 ✓ src/dsl/__tests__/tokenizer.test.ts (41 tests) 34ms
 ✓ src/dsl/__tests__/errors.test.ts (23 tests) 34ms
 ❯ src/audio/__tests__/engine.test.ts (23 tests | 20 failed) 103ms
       × should create AudioContext on first call 66ms
       × should return same instance on subsequent calls (singleton) 5ms
       × should resume suspended context 3ms
       × should not call resume if context is running 3ms
       × should schedule note events with oscillator and gain 5ms
       × should skip rest events 1ms
       × should return a playback token 1ms
       × should increment token on each call 2ms
       × should set correct waveform type 1ms
       × should apply ADSR envelope to gain node 1ms
       × should schedule oscillator start and stop 0ms
       × should skip events before startOffset 1ms
       × should stop all active oscillators 0ms
       × should clear active nodes 1ms
       ✓ should increment playback token to invalidate pending schedules 3ms
       ✓ should return false when no nodes are active 0ms
       × should return true when nodes are active 1ms
       × should return false after stopPlayback 0ms
       ✓ should return 0 initially 0ms
       × should return correct count after scheduling 0ms
       × should default to sine for invalid waveform 0ms
       × should accept triangle waveform 0ms
       × should accept sawtooth waveform 3ms
 ✓ src/dsl/__tests__/parser.test.ts (46 tests) 45ms
 ✓ src/ui/__tests__/app.test.ts (19 tests) 22ms
 ✓ src/dsl/__tests__/integration.test.ts (18 tests) 28ms
 ✓ src/dsl/__tests__/compiler.test.ts (27 tests) 32ms
 ✓ src/dsl/__tests__/phase7.test.ts (55 tests) 46ms
 ✓ src/dsl/__tests__/phase11.test.ts (47 tests) 37ms
 ✓ src/dsl/__tests__/setup.test.ts (1 test) 2ms
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯ Failed Tests 20 ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > getAudioContext > should create AudioContext on first call
TypeError: audioContext.createAnalyser is not a function
 ❯ Module.getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ src/audio/__tests__/engine.test.ts:66:26
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > getAudioContext > should return same instance on subsequent calls (singleton)
TypeError: audioContext.createAnalyser is not a function
 ❯ Module.getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ src/audio/__tests__/engine.test.ts:72:27
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > ensureAudioContextResumed > should resume suspended context
TypeError: audioContext.createAnalyser is not a function
 ❯ Module.getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ src/audio/__tests__/engine.test.ts:80:26
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > ensureAudioContextResumed > should not call resume if context is running
TypeError: audioContext.createAnalyser is not a function
 ❯ Module.getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ src/audio/__tests__/engine.test.ts:89:26
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should schedule note events with oscillator and gain
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:113:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should skip rest events
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:134:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should return a playback token
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:142:28
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should increment token on each call
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:149:29
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should set correct waveform type
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:169:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should apply ADSR envelope to gain node
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:191:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should schedule oscillator start and stop
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:216:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > scheduleEvents > should skip events before startOffset
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:250:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > stopPlayback > should stop all active oscillators
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:273:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > stopPlayback > should clear active nodes
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:298:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > isPlaying > should return true when nodes are active
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:333:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > isPlaying > should return false after stopPlayback
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:351:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > getActiveNodeCount > should return correct count after scheduling
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:386:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > waveform handling > should default to sine for invalid waveform
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:406:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > waveform handling > should accept triangle waveform
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:427:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/20]⎯
 FAIL  src/audio/__tests__/engine.test.ts > Audio Engine > waveform handling > should accept sawtooth waveform
TypeError: audioContext.createAnalyser is not a function
 ❯ getAudioContext src/audio/engine.ts:34:33
     32|     audioContext = new AudioContext();
     33|     // Create analyser node for visualization
     34|     analyserNode = audioContext.createAnalyser();
       |                                 ^
     35|     analyserNode.fftSize = 2048;
     36|     analyserNode.smoothingTimeConstant = 0.8;
 ❯ Module.scheduleEvents src/audio/engine.ts:231:15
 ❯ src/audio/__tests__/engine.test.ts:448:14
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/20]⎯
 Test Files  1 failed | 13 passed (14)
      Tests  20 failed | 417 passed (437)
   Start at  07:46:57
   Duration  1.18s (transform 4.23s, setup 0ms, import 4.88s, tests 447ms, environment 1ms)
